<script>
  const API_URL = "https://liplike-hominine-zara.ngrok-free.dev";
  const tg = window.Telegram.WebApp;

  document.getElementById("join").onclick = async () => {
    try {
      const chatId = tg.initDataUnsafe.start_param;
      const initData = tg.initData;

      if (!chatId) {
        alert("❌ Не удалось определить chat_id");
        return;
      }

      const res = await fetch(`${API_URL}/join`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          chat_id: Number(chatId),
          init_data: initData
        })
      });

      if (!res.ok) {
        const text = await res.text();
        alert("❌ Ошибка сервера: " + text);
        return;
      }

      const data = await res.json();
      alert("✅ Вы присоединились! Игроков: " + data.players.length);
    } catch (e) {
      alert("❌ Ошибка: " + e.message);
    }
  };

  tg.ready();
  tg.expand();
</script>